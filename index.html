<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chat Room</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #ffe6f2; /* Light pink background */
            color: #333;
            margin: 0;
            padding: 20px;
        }
        #chat {
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 10px;
            height: 400px;
            overflow-y: scroll;
            margin-bottom: 10px;
            background-color: #fff; /* White chat background */
        }
        #loginForm, #registerForm, #guestForm {
            margin-bottom: 20px;
        }
        input, button {
            margin: 5px 0;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            width: calc(100% - 22px); /* Adjust for padding */
        }
        #sendButton {
            background-color: #ff80ab; /* Pink button */
            color: white;
            cursor: pointer;
        }
    </style>
</head>
<body>

<h1>Chat Room</h1>

<div id="loginForm">
    <h2>Login</h2>
    <input type="text" id="loginUsername" placeholder="Username" />
    <input type="password" id="loginPassword" placeholder="Password" />
    <button id="loginButton">Login</button>
</div>

<div id="registerForm">
    <h2>Register</h2>
    <input type="text" id="registerUsername" placeholder="Username" />
    <input type="password" id="registerPassword" placeholder="Password" />
    <input type="email" id="registerEmail" placeholder="Email (optional)" />
    <input type="text" id="registerProfilePicture" placeholder="Profile Picture URL" />
    <button id="registerButton">Register</button>
</div>

<div id="guestForm">
    <h2>Guest Login</h2>
    <input type="text" id="guestName" placeholder="Choose a name" />
    <button id="guestButton">Join as Guest</button>
</div>

<div id="chat"></div>

<div id="inputArea" style="display:none;">
    <input type="text" id="messageInput" placeholder="Type your message here..." />
    <button id="sendButton">Send</button>
</div>

<script>
    const ws = new WebSocket('wss://retrotube.info/ws');
    const chat = document.getElementById('chat');
    const messageInput = document.getElementById('messageInput');
    const sendButton = document.getElementById('sendButton');

    // Handle login
    document.getElementById('loginButton').onclick = () => {
        const username = document.getElementById('loginUsername').value;
        const password = document.getElementById('loginPassword').value;
        
        fetch('/login', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ username, password })
        })
        .then(response => response.json())
        .then(data => {
            if (data.username) {
                alert(`Welcome ${data.username}`);
                setupChat(data.username, data.profilePicture);
            } else {
                alert('Login failed');
            }
        });
    };

    // Handle registration
    document.getElementById('registerButton').onclick = () => {
        const username = document.getElementById('registerUsername').value;
        const password = document.getElementById('registerPassword').value;
        const email = document.getElementById('registerEmail').value;
        const profilePicture = document.getElementById('registerProfilePicture').value;

        fetch('/register', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ username, password, email, profilePicture })
        })
        .then(response => response.text())
        .then(message => alert(message));
    };

    // Handle guest login
    document.getElementById('guestButton').onclick = () => {
        const name = document.getElementById('guestName').value;
        setupChat(name, '');
    };

    function setupChat(username, profilePicture) {
        document.getElementById('loginForm').style.display = 'none';
        document.getElementById('registerForm').style.display = 'none';
        document.getElementById('guestForm').style.display = 'none';
        document.getElementById('inputArea').style.display = 'block';

        // Send messages
        sendButton.onclick = () => {
            const message = messageInput.value;
            if (message) {
                ws.send(JSON.stringify({ message, username }));
                messageInput.value = '';
            }
        };

        // Display messages from the server
        ws.onmessage = (event) => {
            const messageData = JSON.parse(event.data);
            if (messageData.type === 'message') {
                const messageElement = document.createElement('div');
                messageElement.textContent = `${messageData.username}: ${messageData.message}`;
                chat.appendChild(messageElement);
            } else if (messageData.type === 'history') {
                messageData.messages.forEach((msg) => {
                    const messageElement = document.createElement('div');
                    messageElement.textContent = `${msg.username}: ${msg.message}`;
                    chat.appendChild(messageElement);
                });
            }
        };
    }
</script>

</body>
</html>
