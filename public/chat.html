<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chat Room</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <h1>Chat Room</h1>
    <div id="chat"></div>

    <div id="inputArea" style="display:none;">
        <input type="text" id="messageInput" placeholder="Type your message here..." />
        <button id="sendButton">Send</button>
    </div>

    <script>
        const ws = new WebSocket('wss://retrotube.info/ws');
        const chat = document.getElementById('chat');
        const messageInput = document.getElementById('messageInput');
        const sendButton = document.getElementById('sendButton');

        const user = JSON.parse(localStorage.getItem('user'));
        if (!user) {
            alert('Please login to access the chat');
            window.location.href = 'login.html';
        }

        sendButton.onclick = () => {
            const message = messageInput.value;
            if (message) {
                ws.send(JSON.stringify({ message, username: user.username }));
                messageInput.value = '';
            }
        };

        ws.onmessage = (event) => {
            const messageData = JSON.parse(event.data);
            if (messageData.type === 'message') {
                const messageElement = document.createElement('div');
                messageElement.textContent = `${messageData.username}: ${messageData.message}`;
                chat.appendChild(messageElement);
            } else if (messageData.type === 'history') {
                messageData.messages.forEach((msg) => {
                    const messageElement = document.createElement('div');
                    messageElement.textContent = `${msg.username}: ${msg.message}`;
                    chat.appendChild(messageElement);
                });
            }
        };
    </script>
</body>
</html>
